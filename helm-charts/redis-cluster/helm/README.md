Helm-чарт для кастомного кластера Redis-Sentinel.

1. В чарте несколько файлов values для каждого стенда свой. При установке указывать через helm upgrade --install .... -f <*-values.yaml>. Файлы должны отличаться номерами портов для сервисов типа NodePort.
2. Пара экземпляров master-slave Redis реализована через deployment, при этом два контейнера master-slave экземпляров находятся в одном поде. Поэтому такая сущность называется redis-couple в соответствующих манифестах.
3. Данный чарт создаёт несколько пар экземпляров master-slave Redis. Количество пар экземпляров master-slave Redis определяется в файле Values.
4. Далее настраивается слежение за ним через 3 экземпляра Sentinel. Количество экземпляров Sentinel захардкожено и равно 3, но можно легко параметризировать и эту часть при необходимости. Не забываем, что количество экземпляров Sentinel должно быть нечётным числом. 3 Sentinel для большинства кейсов вполне достаточно.
5. Т.к. в данной реализации в Kubernetes каждый экземпляр Sentinel является отдельным подом, то при пересоздании по какой-либо причине пода новый экземпляр также начинает следить за состояние экземпляров master-slave, но при этом получает новый ip-адрес. При этом оставшиеся в работе экземлпяры Sentinel считают, что появился новый Sentinel, а старый автоматически не удаляется. Данная ситуация может негативно сказаться на сходимости пары master-slave и для того чтобы удалить несуществующие экземпляры Sentinel мы создаём CronJob который переиодически сбрасывает состояние каждого из экземпляров Sentinel.